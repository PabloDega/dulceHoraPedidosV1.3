<%function monetarizar(valor){
    valor = new Intl.NumberFormat('es-AR', { style: 'currency', currency: 'ARS'  }).format(valor);
    return valor;
}
let facturasocultas = false;%>
<h2>Señas</h2>
<%if(senias.length < 1){%>
        <h1>No se encuentran señas en la base de datos</h1>
<%return}%>
<table id="facturacionLocalSenias">
    <thead>
        <tr>
            <th>Numero</th>
            <th>Fecha</th>
            <th>Total</th>
            <th>Seña</th>
            <th>Resto</th>
            <th>Nombre</th>
            <th>Estado</th>
            <th>Acciones</th>
        </tr>
    </thead>
    <tbody>
        <%senias.forEach((seña) => {
            const observaciones = JSON.parse(seña.observaciones)
            let resto = seña.total - seña.senia;
            let estilo = "seniaPendiente"
            switch (observaciones.estadoSenia) {
                case "retirado":
                    estilo = "seniaRetirada"
                    break;
                case "cancelado":
                    estilo = "seniaCancelada"
                    break;
                default:
                    break;
            }
            // check Fecha -30 Dias
            let fechaRef = Date.parse(fechaHyphen) - (dias * 1000 * 60 * 60 * 24)
            if(Date.parse(seña.fecha) < fechaRef){
                facturasocultas = true;
                return;
            }
            %>
            <tr>
                <td><%=seña.numero%></td>
                <td><%=seña.fechaevento.toLocaleString("es-AR")%></td>
                <td class="importe"><%= monetarizar(seña.total)%></td>
                <td class="importe"><%=monetarizar(seña.senia)%></td>
                <td class="importe"><%= monetarizar(resto)%></td>
                <td><%=observaciones.nombre%></td>
                <td><span class="seniaAll <%= estilo %>"><%=observaciones.estadoSenia%></span></td>
                <td>
                    <%if(observaciones.estadoSenia == "pendiente"){%>
                        <img src="/im/facturado.svg" alt="icono facturar" title="Facturar" data-id="<%=seña.id%>" data-accion="registrar" id="modificarSenia">
                        <img src="/im/cancel.svg" alt="icono facturar" title="Cancelar" data-id="<%=seña.id%>" data-accion="cancelar" id="modificarSenia">
                    <%}%>
                </td>
            </tr>
        <%})%>
    </tbody>
</table>
<%if(facturasocultas){%>
    <div id="verMasSenias" class="btn btnNaranja small">Ver 15 días mas</div>
<%}%>